<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <style>
      :root {
        --c-bg: #fff;
      }

      html.dark {
        --c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <link rel="alternate" type="application/atom+xml" href="https://heeiya.github.io/KDEBlog/atom.xml" title="Blog Atom Feed"><link rel="alternate" type="application/json" href="https://heeiya.github.io/KDEBlog/feed.json" title="Blog JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://heeiya.github.io/KDEBlog/rss.xml" title="Blog RSS Feed"><title>2024 OSPP KDE Project Late-Stage Summary | Blog</title><meta name="description" content="A blog now mainly about my particpation in OSPP with KDE ">
    <link rel="preload" href="/KDEBlog/assets/style-Dfa-YeeG.css" as="style"><link rel="stylesheet" href="/KDEBlog/assets/style-Dfa-YeeG.css">
    <link rel="modulepreload" href="/KDEBlog/assets/app-FS3VdUqr.js"><link rel="modulepreload" href="/KDEBlog/assets/2024OSPP KDE项目末期总结.html-CW3xz_wy.js">
    <link rel="prefetch" href="/KDEBlog/assets/index.html-DU71mR6u.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/2024OSPP KDE社区项目：Porting KDE Games to Android platform.html-BQp7XPmP.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/2024OSPP KDE项目中期总结.html-SBALS85K.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/QML 安卓应用构建与运行.html-WXSXYVV2.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/关于我.html-BnuGNOOm.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-dRaSm_GA.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/2024OSPP KDE社区项目：Porting KDE Games to Android platform.html-FtLNLKz8.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/2024OSPP KDE项目中期总结.html-BoHKeT4Y.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/2024OSPP KDE项目末期总结.html-DJHl7IVV.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/QML 安卓应用构建与运行.html-Crk8UKsv.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/关于我.html-ChHSwdIc.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/404.html-BR8BskV1.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-BgRuw-wM.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-CtxSLmAW.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-B9OJonSE.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-BB38ln7P.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-T1ni99Pw.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-DzFLlam1.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-mQU_9AoN.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-De9QK2ne.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-BoyqMrPl.js" as="script"><link rel="prefetch" href="/KDEBlog/assets/index.html-aQsiNiFJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon"><!--[--><header class="vp-navbar"><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/KDEBlog/"><img class="vp-site-logo" src="https://avatars.githubusercontent.com/u/90752469?s=400&amp;u=69796f3c09ffaa19d5dc128699599458dadb5d14&amp;v=4" alt="Blog"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Blog</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/KDEBlog/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/KDEBlog/article/" aria-label="Article"><!---->Article<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/KDEBlog/timeline/" aria-label="TimeLine"><!---->TimeLine<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/KDEBlog/posts/2024OSPP%20KDE%E9%A1%B9%E7%9B%AE%E6%9C%AB%E6%9C%9F%E6%80%BB%E7%BB%93.html" aria-label="English"><!---->English<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/KDEBlog/zh/posts/2024OSPP%20KDE%E9%A1%B9%E7%9B%AE%E6%9C%AB%E6%9C%9F%E6%80%BB%E7%BB%93.html" aria-label="简体中文"><!---->简体中文<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style="display:none;"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style=""><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar"><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/KDEBlog/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/KDEBlog/article/" aria-label="Article"><!---->Article<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/KDEBlog/timeline/" aria-label="TimeLine"><!---->TimeLine<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/KDEBlog/posts/2024OSPP%20KDE%E9%A1%B9%E7%9B%AE%E6%9C%AB%E6%9C%9F%E6%80%BB%E7%BB%93.html" aria-label="English"><!---->English<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/KDEBlog/zh/posts/2024OSPP%20KDE%E9%A1%B9%E7%9B%AE%E6%9C%AB%E6%9C%9F%E6%80%BB%E7%BB%93.html" aria-label="简体中文"><!---->简体中文<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">2024 OSPP KDE Project Late-Stage Summary <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="_2024-ospp-kde-project-late-stage-summary" tabindex="-1"><a class="header-anchor" href="#_2024-ospp-kde-project-late-stage-summary"><span>2024 OSPP KDE Project Late-Stage Summary</span></a></h1><p>It&#39;s been more than three weeks since the midterm summary, and the project is now nearing completion.</p><p>Currently, all the original features of Blinken have been fully implemented in the QML version. The remaining tasks involve UI adjustments, testing, and fixing potential bugs.</p><p>Over the past few weeks, I’ve been working on the following:</p><h2 id="integrating-blinken-s-logic" tabindex="-1"><a class="header-anchor" href="#integrating-blinken-s-logic"><span>Integrating Blinken&#39;s Logic</span></a></h2><p>The game logic of Blinken is handled by the <code>BlinkenGame</code> class from the original Blinken. The original code design is quite good, with most of the game logic encapsulated in this one class. The separation between the logic and the UI rendering is well done, so all I needed to do was connect the signals from this class in QML.</p><p>As for the audio playback in Blinken, the original code used the Phonon library, which is also open-source but does not support Android. Therefore, I replaced it with the <code>QtMultimedia</code> library, which provides cross-platform audio playback functionality.</p><h2 id="android-build-for-kf6-applications" tabindex="-1"><a class="header-anchor" href="#android-build-for-kf6-applications"><span>Android Build for KF6 Applications</span></a></h2><p>Some features of Blinken rely on libraries provided by the KF6 framework, such as <code>KF6I18n</code> and <code>KF6Config</code>. When cross-compiling to the Android platform, it&#39;s necessary to use the aarch64-linux versions of these libraries. If these libraries are not available on your system, you will encounter the following errors during compilation:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">ld.lld: error: /usr/lib64/libKF6XmlGui.so.6.4.0 is incompatible with aarch64linux ld.lld: error: /usr/lib64/libKF6ConfigWidgets.so.6.4.0 is incompatible with aarch64linux </span>
<span class="line">……</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>However, the package manager on my Fedora distribution does not provide these versions. Compiling and installing them one by one from source is too cumbersome. On the advice of the community, I used <strong>Craft</strong> to handle cross-compilation.</p><p>For reference, here is the Craft tutorial: <a href="https://community.kde.org/Craft" target="_blank" rel="noopener noreferrer">Craft - KDE Community Wiki</a></p><p>Important note: If you encounter installation failures, make sure to clear all contents under <code>craft-kde-android</code> before trying again, as leftover files may cause the installation to fail.</p><p>When installing, choose the <code>Arm64</code> target architecture. If there are remnants from a previous failed installation, it may prevent the option to select the <code>ARM64</code> architecture.</p><p>If you encounter issues like &quot;Permission denied,&quot; you’ll need to disable SELinux:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> selinux-utils </span>
<span class="line"><span class="token function">sudo</span> setenforce <span class="token number">0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Additionally, note that in the virtual machine <code>invent-registry.kde.org/sysadmin/ci-images/android-qt67</code> provided by the community, the Java version is outdated, preventing the use of Gradle 8.6. You can either manually update the Java version in the docker or use an older version of Gradle.</p><p>To use Craft for building applications, you need to write a script called a <strong>Blueprint</strong>, which describes the libraries your application depends on. These scripts are relatively easy to write, and you can quickly get started by following the community documentation: <a href="https://community.kde.org/Craft/Blueprints" target="_blank" rel="noopener noreferrer">Craft/Blueprints - KDE Community Wiki</a>.</p><h2 id="using-kf6-framework-libraries" tabindex="-1"><a class="header-anchor" href="#using-kf6-framework-libraries"><span>Using KF6 Framework Libraries</span></a></h2><p>Some of the libraries originally used by Blinken are compatible with the Android platform, while others are not. By referring to the <a href="https://api.kde.org/frameworks/index.html" target="_blank" rel="noopener noreferrer">API Documentation</a>, you can check which libraries are supported on Android. In Blinken, the following libraries are Android-compatible:</p><ul><li>CoreAddons</li><li>GuiAddons</li><li>I18n</li><li>XmlGui</li></ul><p>I needed to use these libraries in the QML version of Blinken.</p><p>The KF6 framework provides a convenient internationalization API, and the usage in QML is almost the same as in QWidget, which allowed me to directly reuse Blinken’s original multi-language support, saving a lot of time.</p><p>KConfig is used in Blinken to store high score information and settings. For the high scores, I needed to extract the <code>HighScoreManager</code> class from the original <code>HighScoreDialog</code> file, make some modifications, and then create a new high score interface in QML that connects the signals and slots of <code>HighScoreManager</code>. For the settings functionality, it’s as simple as registering a KConfig singleton in QML :</p><div class="language-C++ line-numbers-mode" data-highlighter="prismjs" data-ext="C++" data-title="C++"><pre class="language-C++"><code><span class="line">`qmlRegisterSingletonInstance&lt;blinkenSettings&gt;(&quot;org.kde.blinken&quot;, 1, 0, &quot;BlinkenSettings&quot;, blinkenSettings::self());</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>KF6XmlGui was used in the original Blinken to create the About Blinken Page, About KDE Page, and Handbook Page. Although this library is Android-compatible, it is based on QWidget, while the main interface of Blinken is built with QML. Bringing in QWidget just for these pages didn&#39;t seem like a good idea. Luckily, for the Android platform, <code>kirigami-addons</code> provides this functionality. By incorporating it, I also brought in <code>Kirigami</code>, which helps optimize the UI.</p><p>After adding new dependencies, it’s important to modify the <code>.kde-ci.yml</code> file to support CI/CD. For more information: <a href="https://community.kde.org/Infrastructure/Continuous_Integration_System" target="_blank" rel="noopener noreferrer">Infrastructure/Continuous Integration System - KDE Community Wiki</a>.</p><hr><p>During the build process, there was an error that troubled me for a long time:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">Cannot <span class="token function">find</span> application binary <span class="token keyword">in</span> build <span class="token function">dir</span> /home/user/CraftRoot/build/kde/applications/blinken/work/build/src/android-build//libs/arm64-v8a/libappBlinkenQML_<span class="token punctuation">[</span>arm64-v8a.so<span class="token punctuation">]</span><span class="token punctuation">(</span>http://arm64-v8a.so/<span class="token punctuation">)</span>. ninja: build stopped: subcommand failed.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>After asking the community, someone pointed out the issue.</p><p>In my original <code>CMakeLists.txt</code> file, I used <code>qml_add_executable</code> to create the program object, but this method likely modified the generated <code>.so</code> file&#39;s name, causing a conflict with the method provided by the ECM toolchain and preventing the APK from being generated.</p><p>The solution was to replace <code>qml_add_executable</code> with <code>add_executable</code>.</p><p>This blog post discusses how to port KF6 applications to Android: <a href="https://www.volkerkrause.eu/2023/11/11/kf6-porting-android-apps.html" target="_blank" rel="noopener noreferrer">Porting KDE Android apps to Qt6/KF6</a>, and it mentions this issue. The toolchain provided by ECM can conflict with the one provided by Qt6. The post also provides a few examples of using KF6 code, which were really helpful for me.</p><h2 id="next-steps" tabindex="-1"><a class="header-anchor" href="#next-steps"><span>Next Steps</span></a></h2><p>The project is almost complete. I just need to adjust Blinken&#39;s UI for the Android platform. After testing and fixing any bugs, I can attempt to merge it with the original code.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: hanyangzhang@qq.com">hanyang zhang</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/KDEBlog/assets/app-FS3VdUqr.js" defer></script>
  </body>
</html>
